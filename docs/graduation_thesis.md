# ２０２０年度　卒業論文/ゼミ論文





## ポイントクラウドデータを用いた三人称視点ドローンの提案
## Proposal of Third Person View Drone Using Point Cloud Data







２０２０年２月１日


青山学院大学 地球社会共生学部 地球社会共生学科

森田 浩徳/Hironori Morita

学生番号　1A117163


指導教員　古橋 大地 教授


© Furuhashi Laboratory/Taro Aoyama, CC BY 4.0

# 概要

　近年運送や災害などにドローンが使用されるケースが増えつつあり, 人間とドローンとの関係がより親密になりつつある. それと同時にドローンによる事故が年々増加してしており, より一層ドローンの安全飛行は懸念視されるようになった. 本研究では, 静岡県交通基盤部建設支援局建設技術企画課によりオープンソースとして公開されているポイントクラウドデータを用いて静岡県の街をPotreeを利用して可視化し, それをドローンの操縦のインターフェースに組み込むことにより, 三人称視点ドローンを構成されることを提案する. その結果, 事前準備として, 前もった飛行ルートの構築や状況把握を行うことができるようになるため, 突発的に操縦するよりもより安全な飛行が可能になる. また安全な飛行を築き上げることにより, ドローンの衝突事故の減少に寄与することができる.

　In recent years, drones have been increasingly used for transportation and disasters relief, and the relationship between humans and drones has been becoming more intimate.  At the same time, the number of accidents caused by drones has been increasing year by year, and the safety of drone flight has become more and more of a concern.  This thesis proposes to use Potree to visualize cities in Shizuoka Prefecture using the point cloud data released as open source by the Construction Technology Planning Division, Construction Support Bureau, Transportation Infrastructure Department, and Shizuoka Prefecture.  In addition it is proposed to incorporate point cloud data into the interface of drone operations to construct a third-person view drone.  As a result, the drone operators will be able to construct a flight path and to understand the situation in advance.  The effect will enable safer flights and reduce or eliminate sudden or unexpected maneuvers.  Overall, using a third person view drone builds a safer flight that can contribute to the reduction of drone collisions.







# 序論:

　近年, ドローンは空撮や農業だけでなく, 輸送や災害救助など多岐に渡って活用されている. Radiant Insights（2017）によると, 2021年におけるドローン業界の市場価値は48億ドルにものぼると予測されている. 我々の生活に密接になるほどドローンの需要は計り知れない社会になりつつある. しかし, その需要と比例するかのように, ドローンによる事故が増加している. 

　ドローンの墜落事故には様々な要因があげられ, 強風, 人為的ミス, 接触, 通信途絶などが主な要因となっている. その中でも接触による事故が一番多く, 国土交通省(2019,2010)無人航空機に係る事故トラブル等の一覧によると, 平成31年度（図1-a）には83件中42件, 令和2年度（図1-b）（令和2年11月3日現在）には47件中30件にも及んでいる. 約1年9ヶ月の間に最低130件ものドローンの事故や問題が発生しており, その中でも接触による事故は全体の55%にも及ぶ. 接触の対象として, 一番多いのは電線であり, 家屋, 樹木, 電柱, 電話線と続く. この結果から, ドローンの事故は高い建造物や空中で垂れ下がっているものに接触する傾向にあることがわかる. 

<img width="270" alt="map2d" src="https://user-images.githubusercontent.com/30142240/98460354-05004d80-21e7-11eb-8393-9e2c04b97388.png">  <img width="270" alt="map2d" src="https://user-images.githubusercontent.com/30142240/98460355-0598e400-21e7-11eb-95f0-4e21f1234e34.png">  <img width="270" alt="map2d" src="https://user-images.githubusercontent.com/30142240/98460352-03368a00-21e7-11eb-96b2-34773cb94191.png">

図1-a.平成31年度無人航空機に係る事故トラブル等の一覧を元に作成, 図1-b.令和2年度無人航空機に係る事故トラブル等の一覧を元に作成, 図1-c.接触対象(無人航空機に係る事故トラブル等の一覧(2019, 2020)を元に作成)

　Clarke(2014)の分析では, ドローンにおける最も重要な2つの価値として, 公共の安全とプライバシーへの影響の管理の適切性について慎重に検討する必要があると結論付けている. またYao(2017)によると, ドローン操縦において, 安全の確保は最優先事項であると述べられている. つまり, ドローン操縦において, 安全飛行の重要性は非常に高いことが示されている. 
つまり, 安全飛行を確立させるための, 新たなドローンを創造していく必要がある. 

　そこでドローンの視点に新たな視点を作り上げ, 三人称視点のインターフェースの構築をしていくことにより, 接触事故を減少させるドローンの創造を図った. 

　三人称視点による効果として, Rouse(1999)は, 三人称視点は操作対象を世界全体に移動させるのに適していると結論づけている. さらにSalamin(2006)によると, 三人称視点は存在感と視野の拡大（World View）を供給し, 周りの環境をより把握させると提唱している. 通常移動アクションやその対象との相互作用には三人称視点, 不動の対象物や近距離を操作する場合は一人称視点が有効であり, またユーザーが三人称視点を使用する場合, カメラの位置によって提供される視野が広いため, 距離をより適切に判断し, 操作対象の軌道を予測・推定することが可能になる. したがって, さまざまなアクションで構成されるシミュレーションでは両方の視点が必要であり, それらを切り替えることによって, より効果的に操作することが可能であると述べている. したがって, 本日までに生成されているドローンの視点は, ドローンの操縦において非効率であることがわかる. 

　現在までに三人称視点を利用したドローンとして, Saakes（2013）による上後部にカメラを設置し, 地上車両に第三者の視点を提供するための新しい設計を探求したものや, 天間ら（2020）による空間的に連動する 2 台のドローン用いてインタラクティブに操作可能な三人称視点を提案, Thomasonら（2017）によるポイントクラウドデータをリアルタイム適応視点システムの導入などがある. 周りに障害物がない状態でなら問題ないのだが, 衝突事故の例から考慮すると, ドローンは周りに障害物があるところで操縦されているため, Saakesや天間らの研究でドローンを操縦することは, 非現実的である. Thomasonら（2017）の研究においては, Skydio社が提供しているSkydio2のように実際に実装されている. Skydio2は高性能カメラと人工知能を搭載しているため, 瞬時に状況を判断し, 衝突をしないようにSkydio2自らで進路を組み立てている. 実際に人間や車といった障害物に向かって直進させてみると, 斜め上や横に避けて進んでいた. しかし雑草のような細いものになってくると, 避けていくこともあるのだが, 実際に草をプロペラに巻き込んでしまうこともあった. つまりThomasonら（2017）の研究では, ポイントクラウドデータを再構築する際に, ノイズや遅延などが結果に影響を与える可能性があると, より危険な状況を招いてしまうことがある. したがって, 人工知能に頼るのではなく, 最終的には操縦者の技量が不可欠となる. 

　そこで操縦者の技量を発揮させる環境づくりも必要となる. Endsley（1995）では, 動的環境における適切な判断やより良いパフォーマンスが期待するには, 状況認知（Situational Awareness）が大切であると述べている. 状況認知は, 知覚(Perception), 理解(comprehension), 予測(projection）のステップで構成されており, これらの要素を満たすことによって, 操縦者の力が発揮されるという訳である. 天間ら（2019）によると, 状況認識ができないまま操縦をすると, 操縦者は身体的ストレスが発生し, 操縦の質が低下する可能性があると述べている. つまり, 目視外飛行が困難である要因は, 操縦者によるドローン周囲の状況認知が乏しくなるためである. さらにStanton（2001）は, 状況認識の改善は認知作業量を減らすためのシステムインターフェースの設計, 個人およびチームレベルでの状況認識のトレーニングが大切であると述べている. したがって, パイロットがストレスなくドローンを操縦するには, よりシンプルなシステムインターフェースの構築をし, 状況認知を高めやすい環境を創造させる必要がある. 

　以上からわかるように, ドローンは移動することが必然的であるため, 三人称視点での操作が効率的であることがわかる. さらに三人称視点では, ドローンとその他障害物との距離感の把握がしやすくなるため, 接触を防ぐ可能性は高まるに違いない. また, リアルタイムでポイントクラウドデータを取得し, 人工知能で瞬時にデータ解析させることは非常に効果的である. しかし人工知能だけに頼るのでなく, 最終的には操縦者がドローンの操縦付近の状況を把握することが大切である. そこで本研究では, ドローンを操縦する際に事前に状況認知をさせるための手法として, ドローンを飛行させる前に取得したポイントクラウドデータを可視化させる. そこから得た情報を元に操縦をすることによって, ドローン操縦者の技量をより発揮させることができる状況を作りあげる方法を提案する. またドローンの操縦者は不特定多数いるため, 誰もが利用できる状況を作り上げることを前提条件とする. 


# 研究方法:

　はじめに, ポイントクラウドデータを可視化させるために, 3次元コンピュータグラフィックス（以下:3DCG）の導入が必要となる. 今回は, ブラウザ上で3Dが扱えるツールとしてWebGLのPotreeを使用する. Potreeは無償で使用することができ, ローカルサーバーを使用しブラウザで表示をさせるため, サードパーティーの導入をさせる必要がない. 

　ポイントクラウドデータに関しては, LIDAR（Laser Imaging Detection and Ranging）を使用し, リモートセンシングで取得することができる. 本稿では, 静岡県交通基盤部建設支援局建設技術企画課が”静岡県ポイントクラウドデータベース”でデータを公開しているため, そちらをダウンロードし利用する. 静岡県ポイントクラウドデータベースで公開されているデータは, LAS形式となっている. ポイントクラウドデータはデータが大きくなりやすく, 静岡県（2020）は, 「各々のファイルの平均サイズが約300MBで, 大きいもので5.2GBある」と述べている. つまりポイントクラウドデータの共有は問題が生じやすい. しかし, Schuetz（2016）は, 莫大なデータをユーザー間で転送することが可能であると述べている. またKumarら（2019）は, WebGLベースのインターフェイスでポイントクラウドをレンダリングするため, 効率的な移植性（共有・配布・公開）が可能であると結論づけている. さらに, ポイントクラウドのリアルタイムレンダリングをサポートしているため, レンダラーの読み込み時間が大幅に短縮されるとも述べている. したがって, Potreeを活用することは, 莫大なデータを効率的に解析し, データの共有も安易に行うことができる. 

　Potreeを使用する際に, LASファイルをPotree用のLASにコンバートする必要があるため, PotreeConverter, さらにもっと容易にPotree使用するためのPotreeDesktopも同様に使用し, ポイントクラウドデータを可視化していく. 





## 研究結果:

　まずPotreeを使用するには, Node.jsを使用して, JavaScript環境で動かしていくことになる. Homebrewで環境作りを行うため, macOSならTerminal, windowsならコマンドプロンプトを使用してPotreeを起動させていく. 

 　実際にGitHub DesktopとNode.jsを利用することにより, macOSとwindows双方で, ローカルサーバーを起動させることが可能であった. しかし, PotreeConverterとPotreeDesktopに関しては, macOSが非対応となっており, windows版でしか起動させることができない状態になっている. 
 
　Potreeの初期設定で, npmをインストールし, その後Potreeの構造が明らかになる. Potreeファイルの中にCodeが生成されており, SourceやLibraryなどがここで管理される. 実際に使用するのは, ”examples”のみとなっており, このexamplesファイルの中にHTMLファイルが格納されている. そのHTMLファイルを起動させることにより, Potreeが起動する仕組みとなっている. 

　Potreeを起動させると, データの処理の速さが明らかに違うことがわかる. 研究方法でも述べたように, 莫大なデータをブラウザで処理する場合, 処理に甚大な時間がかかることが懸念事項である. 実際アニメーション等に対応している3DCGソフトのSketchfabにおいては, 47MBの容量でアップロードから処理までに3分45秒要する. そこから起動させるまでにモデリングを行うのだが, さらに43秒費やしており, 実際に3Dモデルを利用するまでに計4分28秒かかった. 一方でPotreeConverterを使用すると, 同じファイルをPotreeConverterで開くと, 31秒でモデリングが完了する. この結果からわかるように, 同じファイルを開いたとしても, 約4分間短縮させることができる. さらにPotreeは処理能力にも長けており, 3DCGを動かしても滑らかに処理が行われる. 完全にラグが発生しない訳ではないのだが, Sketchfabに比べて円滑に操作することができる. 

　またSketchfabは有償となっているため, 誰もが気軽に手を付けれるソフトウェアではない. 1ヶ月はトライアルとして利用することができるのだが, 50MBのファイルまでと限定されている. 対しPotreeはフリーソフトウェアとなっているため, リスクなしで利用することが可能である. またファイルの解析容量に制限がないため, ファイルサイズが大きくなりがちなLASファイルでも問題なくコンバートをかけることができる.  

　さらにPotreeはSketchfabと異なり、ローカルで使用しているため, オフラインでも使用が可能となる. PotreeConverterとPotreeDesktopも同様にオフラインで使用することが可能であった. 

　Potreeでは, 様々な機能を使用することができ, 距離, 標高, 角度, 面積, 体積, 断面図などの測定をすることができる. またこれらの測定の正確性は非常に高く, 1cm単位でのデータの取得が可能である. 

　国土交通省（2019）は道路標識の設置計画において, 「道路標識を歩道等に設置する場合で, 路上施設を設置するための帯状の 部分がなく, かつ十分な歩道等の幅員を確保できない場合, 標示板の設置 高さを 2.5m 以上とするものとする」と設定している. また, 標識令では標示板の基本寸法が定められており, 規制標識においては60cmを基本としている(KiCTEC). 以下の写真から, 路肩左に標識があり, 一番下の標識が駐車禁止, つまり規制標識であることがわかる. したがって, ここでの標識は, 地上2.5m以上, 幅60cmである. 



<img width="1440" alt="map2d" src="https://github.com/furuhashilab/2020gsc_HironoriMorita/blob/master/photos/thumb-2048.jpg?raw=true">
CC BY-SA ©️drivephotograph/Mapillary


　実際にPotreeのツールを使って調べてみる. まず高さが2.61m, 幅が0.60mとなっていることがわかる. ポイントクラウドデータの質によって, 多少の誤差が生じるかもしれないが, 測定結果が規定通りであることから, Potreeの正確性が確証された. 



<img width="1440" alt="map2d" src="https://github.com/furuhashilab/2020gsc_HironoriMorita/blob/master/photos/Route%20323.png?raw=true">
CC BY 4.0 ©️Shizuoka Point Cloud DB


# 考察:

　前提条件として誰もが利用できるツールを想定していたため, macOSユーザーには不条理な結果となってしまっている. しかしPotreeConverterでPotree用にファイルをコンバートかけることができるのであれば, そのファイルの共有することによってmacOSでも使用することが可能になる. 

 PotreeConverterは最新（January 31st, 2021）のものでバージョン2.1が公開されている. 実際にバージョン2.0.1でコンバートをかけると, metadataというJSONファイル, hierarchy.bin, octree.binが生成される. PotreeDesktop上でコンバートをかけても同様のファイルが生成される仕組みになっている. しかしこれらのファイルでPotree上でモデリングを行うことは不可能である. 研究結果で述べたように, Potreeの起動は, HTMLファイルから起動させることになっている. しかしPotreeConverterやPotreeDesktopでコンバートをかけるとHTMLファイルが生成されない. Potreeのマニュアルでは, /PotreeConverter.exe C:/pointclouds/data.las -o C:/pointclouds/data_converted と記入してコンバーターを実行させるとされている. しかし語尾に/PotreeConverter.exe C:/pointclouds/data.las -o C:/pointclouds/data_converted -p “filename” を入れることにより, HTMLファイルが生成される. しかしバージョン2.0.1ではHTMLファイルは生成されなかったため, バージョン1.7に落とす必要がある. PotreeDesktopでもバージョン1.7でコンバートをかけることができるのだが, HTMLファイルは生成されないため, Potree Converter 1.7を使用する必要がある. 

 実際に上記の方法でPotree Converter 1.7コンバートが行われると, HTMLファイル, pointcloudファイル, libsファイルが生成される. ここで出来上がったファイルを/Github/potree/examples/に移行させる. そしてPotreeを起動させ, ローカルホストでexampleファイルの中の生成したHTMLファイルを起動させれば, macOSでもPotreeでモデリングすることが可能になる. 
 
 
 
 <img width="1440" alt="map2d" src="https://github.com/furuhashilab/2020gsc_HironoriMorita/blob/master/photos/20210206%20%E3%82%BC%E3%83%9F%E8%AB%96%E6%9C%80%E7%B5%82%E7%99%BA%E8%A1%A8.png?raw=true">
CC BY 4.0 ©️Hironori Morita/Furuhashilabs


　また実際にPotreeの精度が高ければ高くなるほど, 周囲をより鮮明に認知することが可能になるということである. 例えば森林地区におけるドローンの飛行は, 周囲認知で必要な情報量が多くなる. 基本的には, 樹木という単位で見るならば, 木が一本あると言った本単位での会話が行われる. しかしドローンの操縦においては, 木が何本あるというだけでなく, 樹枝がどのように飛び出ている, 葉っぱが舞い散っているなど, 同じ樹木という単位で見ても, 情報量が異なってくる. さらに樹木のように環境の影響を受けやすいものであればあるほど, 突発な情報の処理は困難になりやすい. 前もって情報を獲得するために, 写真などから情報を受け取ろうとしてみても, 実際には細かいものまで鮮明に写っていることは少ない. しかしポイントクラウドデータを使用することにより, 細かい部分まで鮮明に表現することが可能になる. さらにPotreeのツールを使うことにより, 1cm単位での数値を測ることが可能になるため, それらの情報がより実際の状況をイメージさせる. 無論ドローンの接触事故においては電線に引っかかることが最多であり, 中部電力が実際に使用している鋼心アルミより線太さは28.5mmである. つまり3cm以下のものによる事故の多発具合から, 1cmだからといい軽視はできない. 



## まとめ:

　本研究では, ドローンによる接触事故を減少させるために, 状況認知を向上させるための手法として, Potreeによるポイントクラウドデータをモデリングさせた. 需要が急増しており, 今後ドローンは我々の生活に欠かせないという予測は立っているが, その安全性を懸念する声が未だに絶えない. 技術革新が進んでいるため, ドローンの機体自体のスペックは向上しているのだが, 操縦士の技術や知識, 判断ミスによる事故が絶えないためである. 

　そこで, パイロットの状況認知を向上させるための手法として, Potreeを提唱した. 3DCGを扱うためのアプリケーションは多数存在するのだが, 誰もが使用できる, そしてユーザーインターフェースが使いやすいという点から, ドローン操縦のための状況認知向上にはPotreeでポイントクラウドデータを取り扱うことべきであると考える. 

　今後はPotreeに地理空間情報システムを導入し, 実際にユーザーインターフェースの中にドローンを組み込むことにより, 三人称視点の構築が可能であると考える. またLASファイルによって, コンバートできるできないのバグも生じているため, その解明も迅速に行う必要がある. 今後は上記の問題を解決し, GISやユーザーインターフェースを導入に取り組み, 状況認知向上と三人称視点ドローンの構築を図っていく. 




## 参考文献:
https://docs.google.com/spreadsheets/d/1SqWbWC4D3u2Vbwbv_iG5InuWjjWH3I6bfxhcfYMrvZE/edit#gid=0

## 謝辞:
　本研究を進めるにあたり古橋教授, 土地家屋調査士藤井十章事務所 代表 藤井十章氏, お笑いタレント 谷+1。氏をはじめ多くの方々より多大な助言を賜りました. 厚く感謝を申し上げます.

*** 
## [卒論本文](https://furuhashilab.github.io/2020gsc_HironoriMorita/docs/graduation_thesis.html)
## [ゼミ論文最終発表スライド](https://speakerdeck.com/22hero1072/pointokuraudodetawoyong-itasan-ren-cheng-shi-dian-doronfalseti-an)
## [リポジトリ](https://github.com/furuhashilab/2020gsc_HironoriMorita)
## [進捗管理用プロジェクト](https://github.com/furuhashilab/sotsuron2020/projects/4)


<div align="center">
<img width="50" alt="map2d" src="https://github.com/furuhashilab/2020gsc_HironoriMorita/blob/master/photos/%E3%83%9B%E3%83%BC%E3%83%A0%20%E3%82%A2%E3%82%A4%E3%82%B3%E3%83%B3%E7%B4%A0%E6%9D%90%208.png?raw=true" alt="属性" title="">
</div>
